---
interface ActivityEntry {
  id: string;
  action: string;
  performedBy: string;
  note: string | null;
  createdAt: string;
  componentName: string;
  version: string;
}

interface Props {
  entries: ActivityEntry[];
}

const { entries } = Astro.props;

const actionConfig: Record<string, { icon: string; label: string; color: string }> = {
  created: { icon: '+', label: 'draft created', color: '#fbbf24' },
  submitted_for_review: { icon: '>', label: 'submitted for review', color: '#60a5fa' },
  approved: { icon: '\u2713', label: 'approved', color: '#4ade80' },
  published: { icon: '\u2605', label: 'published', color: '#4ade80' },
  rejected: { icon: '\u2717', label: 'rejected', color: '#f87171' },
};

function timeAgo(dateStr: string): string {
  const diff = Date.now() - new Date(dateStr).getTime();
  const minutes = Math.floor(diff / 60000);
  if (minutes < 60) return `${minutes}m ago`;
  const hours = Math.floor(minutes / 60);
  if (hours < 24) return `${hours}h ago`;
  const days = Math.floor(hours / 24);
  if (days < 7) return `${days}d ago`;
  const weeks = Math.floor(days / 7);
  return `${weeks}w ago`;
}
---

<div class="timeline">
  {entries.length === 0 && (
    <p class="empty">No activity yet</p>
  )}
  {entries.map((entry) => {
    const config = actionConfig[entry.action] || { icon: '\u2022', label: entry.action, color: 'var(--text-muted)' };
    return (
      <div class="timeline-entry">
        <span class="timeline-icon" style={`color: ${config.color}; border-color: ${config.color};`}>
          {config.icon}
        </span>
        <div class="timeline-content">
          <span class="component-name">{entry.componentName}</span>
          {entry.version && <span class="version">{entry.version}</span>}
          <span class="action">{config.label}</span>
          {entry.note && <span class="note">{entry.note}</span>}
        </div>
        <span class="time">{timeAgo(entry.createdAt)}</span>
      </div>
    );
  })}
</div>

<style>
  .timeline {
    display: flex;
    flex-direction: column;
  }

  .empty {
    color: var(--text-muted);
    text-align: center;
    padding: 48px 16px;
  }

  .timeline-entry {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 12px 16px;
    border-bottom: 1px solid var(--border);
    transition: background 0.15s;
  }

  .timeline-entry:hover {
    background: var(--bg-hover);
  }

  .timeline-entry:last-child {
    border-bottom: none;
  }

  .timeline-icon {
    flex-shrink: 0;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid;
    border-radius: 50%;
    font-size: 11px;
    font-weight: 700;
    margin-top: 2px;
  }

  .timeline-content {
    flex: 1;
    display: flex;
    flex-wrap: wrap;
    align-items: baseline;
    gap: 6px;
    font-size: 14px;
  }

  .component-name {
    color: var(--text-primary);
    font-weight: 500;
  }

  .version {
    color: var(--text-secondary);
    font-family: var(--font-mono);
    font-size: 13px;
  }

  .action {
    color: var(--text-secondary);
  }

  .note {
    color: var(--text-muted);
    font-size: 13px;
    width: 100%;
  }

  .time {
    flex-shrink: 0;
    color: var(--text-muted);
    font-size: 12px;
    white-space: nowrap;
  }
</style>
